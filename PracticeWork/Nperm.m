function p=Nperm(A)
% calculate the permanent of square matrices by Ryser-NW method
% input:  A is a square matrix
% output: p is the permanent of matrix A
% A.Nijenhuis, H.S.Wilf, Combinatorial Algorithms for Computers and 
% Calculators, 2nd ed., Academic Press, 1978, Chapter 23.

n=length(A);p=0;
if n==1
    p=A; return;
end
if n==2
    p=A(1,1)*A(2,2)+A(1,2)*A(2,1); return;
end
if n==3
    p=A(1,1)*(A(2,2)*A(3,3)+A(2,3)*A(3,2))+A(1,2)*(A(2,1)*A(3,3)+A(2,3)*A(3,1))+...
        A(1,3)*(A(2,1)*A(3,2)+A(2,2)*A(3,1)); return;
end    
if n==4
    p=A(1,1)*(A(2,2)*(A(3,3)*A(4,4)+A(3,4)*A(4,3))+A(2,3)*(A(3,2)*A(4,4)+A(3,4)*A(4,2))+...
        A(2,4)*(A(3,2)*A(4,3)+A(3,3)*A(4,2)))+...
        A(1,2)*(A(2,1)*(A(3,3)*A(4,4)+A(3,4)*A(4,3))+A(2,3)*(A(3,1)*A(4,4)+A(3,4)*A(4,1))+...
        A(2,4)*(A(3,1)*A(4,3)+A(3,3)*A(4,1)))+...
        A(1,3)*(A(2,2)*(A(3,1)*A(4,4)+A(3,4)*A(4,1))+A(2,1)*(A(3,2)*A(4,4)+A(3,4)*A(4,2))+...
        A(2,4)*(A(3,2)*A(4,1)+A(3,1)*A(4,2)))+...
        A(1,4)*(A(2,2)*(A(3,3)*A(4,1)+A(3,1)*A(4,3))+A(2,3)*(A(3,2)*A(4,1)+A(3,1)*A(4,2))+...
        A(2,1)*(A(3,2)*A(4,3)+A(3,3)*A(4,2)));  return;
end   
if n==5
    p=(A(1,1)*A(2,2)+A(1,2)*A(2,1))*(A(3,3)*(A(4,4)*A(5,5)+A(4,5)*A(5,4))+A(3,4)*(A(4,3)*...
        A(5,5)+A(4,5)*A(5,3))+A(3,5)*(A(4,3)*A(5,4)+A(4,4)*A(5,3)))+...
        (A(1,1)*A(2,3)+A(1,3)*A(2,1))*(A(3,2)*(A(4,4)*A(5,5)+A(4,5)*A(5,4))+A(3,4)*(A(4,2)*...
        A(5,5)+A(4,5)*A(5,2))+A(3,5)*(A(4,2)*A(5,4)+A(4,4)*A(5,2)))+...
        (A(1,1)*A(2,4)+A(1,4)*A(2,1))*(A(3,3)*(A(4,2)*A(5,5)+A(4,5)*A(5,2))+A(3,2)*(A(4,3)*...
        A(5,5)+A(4,5)*A(5,3))+A(3,5)*(A(4,2)*A(5,3)+A(4,3)*A(5,2)))+...
        (A(1,1)*A(2,5)+A(1,5)*A(2,1))*(A(3,3)*(A(4,4)*A(5,2)+A(4,2)*A(5,4))+A(3,4)*(A(4,3)*...
        A(5,2)+A(4,2)*A(5,3))+A(3,2)*(A(4,3)*A(5,4)+A(4,4)*A(5,3)))+...
        (A(1,2)*A(2,3)+A(1,3)*A(2,2))*(A(3,1)*(A(4,4)*A(5,5)+A(4,5)*A(5,4))+A(3,4)*(A(4,1)*...
        A(5,5)+A(4,5)*A(5,1))+A(3,5)*(A(4,1)*A(5,4)+A(4,4)*A(5,1)))+...
        (A(1,2)*A(2,4)+A(1,4)*A(2,2))*(A(3,3)*(A(4,1)*A(5,5)+A(4,5)*A(5,1))+A(3,1)*(A(4,3)*...
        A(5,5)+A(4,5)*A(5,3))+A(3,5)*(A(4,3)*A(5,1)+A(4,1)*A(5,3)))+...
        (A(1,2)*A(2,5)+A(1,5)*A(2,2))*(A(3,3)*(A(4,4)*A(5,1)+A(4,1)*A(5,4))+A(3,4)*(A(4,3)*...
        A(5,1)+A(4,1)*A(5,3))+A(3,1)*(A(4,3)*A(5,4)+A(4,4)*A(5,3)))+...
        (A(1,3)*A(2,4)+A(1,4)*A(2,3))*(A(3,1)*(A(4,2)*A(5,5)+A(4,5)*A(5,2))+A(3,2)*(A(4,1)*...
        A(5,5)+A(4,5)*A(5,1))+A(3,5)*(A(4,1)*A(5,2)+A(4,2)*A(5,1)))+...
        (A(1,3)*A(2,5)+A(1,5)*A(2,3))*(A(3,1)*(A(4,4)*A(5,2)+A(4,2)*A(5,4))+A(3,4)*(A(4,1)*...
        A(5,2)+A(4,2)*A(5,1))+A(3,2)*(A(4,1)*A(5,4)+A(4,4)*A(5,1)))+...
        (A(1,4)*A(2,5)+A(1,5)*A(2,4))*(A(3,3)*(A(4,1)*A(5,2)+A(4,2)*A(5,1))+A(3,1)*(A(4,3)*...
        A(5,2)+A(4,2)*A(5,3))+A(3,2)*(A(4,3)*A(5,1)+A(4,1)*A(5,3))); return
end
b=zeros(n-1,1);
p=-prod(A(:,n));
for k=1:2^(n-1)-1
    %b=dec2bin(k,n-1)-48;
    for j=1:n-1
        if b(j)==0
            b(j)=1; break
        else
            b(j)=0;
        end
    end
    sn=sum(b);sm=find(b);
    a1=sum(A(:,sm),2);a2=a1+A(:,n);
    p=p+(-1)^sn*(prod(a1)-prod(a2));
end
p=(-1)^n*p;